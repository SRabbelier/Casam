\section{Aanpak}
\label{Aanpak}
Een van de eerste beslissingen die moest worden genomen is de architectuur van het systeem. Al snel bleek dat de opdrachtgever een voorkeur had voor een webapplicatie die door het hele Erasmus MC op het netwerk simpel en snel gebruikt kon worden. 
Voor onze Image Processing kregen wij het advies van Dr. Botha om een aantal Python bibliotheken te bekijken en deze indien mogelijk te gebruiken. 

De combinatie van deze feiten leidde ons richting Django, dit is een python framework voor het bouwen van websites in Python. Na wat research en de ervaringen die \'{e}\'{e}n van de projectleden al had met Django hebben we ervoor gekozen om Django te gaan gebruiken. 

Voor wat betreft de visuele interactie hebben we gekeken naar verschillende Javascript bibliotheken, mede door de uitgebreide ervaringen van diverse leden hebben we uiteindelijk gekozen voor de combinatie van Prototype en Scriptaculous.

Tijdens het project bleek uiteindelijk dat er behoefte was aan een tekenapplicatie binnen de omgeving en deze was niet te realiseren via Javascript en is er uiteindelijk ook nog een Flash applicatie geschreven welke communiceert met Javascript.

\subsection{Project gerelateerd}
In de begin periode hebben wij ons ingelezen op de basis anatomische kennis die nodig was om de experts van het Erasmus MC te kunnen volgen. Hierbij hebben we vooral veel gebruik gemaakt van de kennis van \'{e}\'{e}n van de groepsleden, die voor ze aan deze studie begon drie jaar. Ook zijn we een dag langs geweest bij het EMC en hebben daar een rondleiding gehad door het laboratorium en de snijzalen waar onderzoek wordt gedaan. 

Een andere uitdaging was de relatief grote groep studenten voor dit project. Om te voorkomen dat we elkaar te veel in de weg zouden zitten hebben we de diverse delen van het project opgesplitst en de taken duidelijk verdeeld. Daarnaast hebben we gebruik gemaakt van software zoals Trac, dit is een Project Management Systeem. Daarnaast was een locatie geregeld op de TU Delft waar we iedere dag hebben gewerkt en waar we elke ochtend een werkoverleg konden hebben voor wat er die dag zou gebeuren. Hierdoor bleef iedereen goed op de hoogte van de status van het gehele project.

\subsection{Database systeem}
Het database systeem is het onderdeel van het project dat dient om de gebruikte foto's overzichtelijk in te delen in verschillende projecten. Hiervandaan wordt de gebruiker in staat gesteld om de handelingen te verrichten die nodig zijn om analyse te plegen op  foto's. Typische handelingen zijn bijvoorbeeld: 

\begin{itemize}
\item Aangeven van herkenningspunten bij de foto's
\item Afbeeldingen tekenen over foto's om belangrijke gebieden aan te geven, ook wel bitmaps genoemd
\item Verschillende doorzichtige foto's over elkaar heenleggen om de verschillen te bekijken
\item Toevoegen van relevante papers en websites bij een project
\item Tags toevoegen bij projecten om ze te categoriseren
\item Vastleggen van interessante configuraties om de foto's en bijbehorende informatie te tonen, ook wel states genoemd
\item Afstanden meten in foto's
\item Een knop aanbieden om een Point Distribution Model te cre\"{e}ren
\end{itemize}

Zoals in de paragraaf Aanpak al aangegeven zouden we gaan werken met Django en moest het product beschikbaar worden als webapplicatie. Django is een Model View Controller opgebouwde taal, wat wil zeggen dat het datamodel en functionaliteit met betrekking tot het datamodel gescheiden is van de gebruikersinterface en functionaliteit met betrekking tot de gebruikersinterface. Django heeft ook een duidelijk abstractie laag voor het database gedeelte, een Object-Relational Database Mapping. Deze maakt het mogelijk om in een object\-ge\"{o}rienteerde taal te programmeren, maar de aangemaakte objecten worden direct gemapt op een relationele structuur, zodat de objecten kunnen worden opgeslagen in relationele database, en dit verlicht de implementatie aanzienlijk. Na diverse brainstorm sessies zijn we uiteindelijk uitgekomen op een klasse diagram\pageref{Databasediagram} wat de basis zou gaan vormen voor het database systeem.

Ook gebruikers\-beheer is standaard een onderdeel van Django, waardoor dit voor een groot deel niet meer door ons gedaan zou hoeven worden.

Voor de interface hebben we ervoor gekozen om veel gebruik te maken van JavaScript en zijn bibliotheken. Dit gaf ons eenvoudige toegang tot diverse visuele effecten, zoals drag en drop, fade en de sliders). Daarnaast konden we met behulp van JavaScript gebruik maken van de AJaX techniek, hiermee konden server requests sturen en de pagina updaten zonder dat de gebruiker hier last van had.

In de ontwerpfase is besloten dat het mogelijk moet zijn om uitwisseling van datasets tussen gebruikers. Om te zorgen dat gebruikers verschillende projecten kunnen uitwisselen is hier al in een vroeg stadium rekening mee gehouden. Er is gekozen alle objecten die worden gebruikt op te slaan met Universal Unique ID's, wat wil zeggen dat de kans dat bij het kopi"{e}ren van objecten objecten een zelfde identificator hebben zodanig klein is, dat hij wordt beschouwd als niet bestaand. Hierdoor is het mogelijk om datasets uit te wisselen tussen verschillende databases zonder dat er conflicten optreden.

\subsection{Image Processing}
De doelen op Image Processing gebied waren: het in kaart brengen van de variaties per landmark en het morphen van getekende structuren (bijvoorbeeld zenuwen of venen) naar een standaardview. Zo kunnen structuren die van verschillende foto's afkomen toch op \'{e}\'{e}n foto worden afgebeeld.

\subsubsection{Point Distribution Model}
Om het eerste doel te bereiken hebben we gebruik gemaakt van een subonderdeel van een volledig Active Shape Model, namelijk het Point Distribution Model. Het Active Shape Model is ontwikkeld door Tim Cootes, in de paper An Introduction to Active Shape Models licht hij de theorie toe.\cite{introASM}

Waar het Active Shape Model zich bezighoudt met het automatisch herkennen van structuren uit een foto, is het Point Distribution Model\cite{pdm} in staat om gegeven een aantal landmarks (van hetzelfde type) op verschillende foto's het gemiddelde en de hoofdassen van variatie weer te geven. Een landmark is een punt dat zo is gekozen dat het in iedere foto te vinden is en duidelijk op iedere foto te vinden is. De landmarks die gebruikt worden voor het Point Distribution Model moeten informatie geven over het verloop van een structuur, bijvoorbeeld het aangeven van het verloop van een bepaalde vene.

\subsubsection{Thin Plate Spline Transformatie}
Om het tweede doel te bereiken, het morphen van getekende structuren, is er gebruik gemaakt van een Thin Plate Spline Transformatie (TPS). Om de TPS transformatie uit te voeren zijn landmarks nodig die bepalend zijn voor de vorm van een object. Hierbij kan gedacht worden aan een set van landmarks die bestaat uit bony landmarks \footnote{landmarks die voortkomen uit de anatomie van het menselijk lichaam en voelbaar zijn vanaf de buitenkant}, landmarks die de grenzen van het object aangeven en landmarks die zich op gelijke afstanden tussen voorgaande landmarks bevinden. 
Impliciet zit er in dit doel nog een Image Processing doel verwerkt, namelijk het aangeven van lijnen, gebieden of punten die interessant zijn voor de onderzoeker. We hebben ervoor gekozen om de onderzoeker dit realtime te laten doen in de applicatie door gebruik van Flash.


\subsubsection{Tekenen}
Impliciet zit er in dit doel nog een Image Processing doel verwerkt, namelijk het aangeven van lijnen of gebieden die interessant zijn voor de onderzoeker. We hebben ervoor gekozen om de onderzoeker dit in de browser te laten doen als ge\"{i}ntegreed tekenprogramma. Hierbij zal het mogelijk zijn elke foto als achtergrond te kiezen en hieroverheen met \'{e}\'{e}n kleur bepaalde gebieden aan te geven.

Binnen browsers zou dit tekenprogramma gemaakt kunnen worden door gebruik te maken van Canvas, een onderdeel van de nieuwe HTML-standaard, maar nog niet ondersteund wordt door Internet Explorer 6. Omdat we tijdens de keuze van de techniek er vanuit gingen dat het systeem in IE 6 moest draaien hebben we gekozen om niet Canvas maar Flash te gebruiken. Dit vereist een plugin in de browser, maar bijna iedereen heeft deze plugin.

Over de theoretische achtergrond van de verschillende gebruikte technieken is meer te vinden in het ori\"{e}ntatieverslag.
