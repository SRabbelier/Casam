{% extends 'base.html' %}

{% block title %}Overzicht projecten en foto's{% endblock title %}

{% block scripts %}
  <link href="/media/css/projectHome.css" rel="stylesheet" type="text/css" media="screen" />
  <script type="text/javascript">
  var total_images = 0;
  </script>
  
  
  <script type="text/javascript">
	  document.observe("dom:loaded", function() {
			document.observe('mousemove',getMouseXY);
			$('pictureContainer').hide();
			getProjectImages();
			$('pictureContainerHeader').observe('click',function(){
					Effect.toggle('pictureContainer','blind');
				});
		});

		function getProjectImages()
		{			
			var url = 'projectImagesJSON/{{id}}'
				// notice the use of a proxy to circumvent the Same Origin Policy.
				new Ajax.Request(url, {
				  method: 'get',
				  onSuccess: function(transport,json) {
				     var json = transport.responseText.evalJSON();
				     $('pictureContainerHeader').update('Pictures('+json.length+')');
				     for(i=0;i < json.length;i++)
				     {
								makePictureContainer(json[i]);
				     }
				     Effect.BlindDown('pictureContainer');
					}
				});
		}

		function makePictureContainer(pictureJSON)
		{
		     var mainDiv = new Element('div');
		     var leftDiv = new Element('div');
		     leftDiv.addClassName('pictureContainerLeftDiv');
		     var rightDiv = new Element('div');
		     rightDiv.addClassName('pictureContainerRightDiv');
		     mainDiv.addClassName('projectPictureDiv');
		     leftDiv.insert(new Element('img',{'src':'{{DATADIR}}thumbnail/50/'+pictureJSON.fields.path}));
		     rightDiv.insert(new Element('span').update(pictureJSON.fields.name).addClassName('projectPictureInfo'));
		     rightDiv.insert(new Element('span').update(pictureJSON.fields.added).addClassName('projectPictureInfo'));
		     if(pictureJSON.fields.isLeft)
		     {
		    	 rightDiv.insert(new Element('span').update('Left').addClassName('projectPictureInfo'));
		     }else{
		    	 rightDiv.insert(new Element('span').update('Right').addClassName('projectPictureInfo'));
		     }
		     var useLink = new Element('a',{'href':'#'}).update('Use');
		     rightDiv.insert(useLink);
		     $('pictureContainer').insert(mainDiv);
		     useLink.observe('click',function(){
		    	 show_image('{{DATADIR}}'+pictureJSON.fields.path);
		    	 return false;
			   });
			   mainDiv.insert(leftDiv);
			   mainDiv.insert(rightDiv);
		}
  </script>

{% endblock scripts %}

{% block body %}
	<div style="float: left; border: 1px solid grey;">
		<div id="pictureContainerHeader">Pictures (loading)</div>
		<div id="pictureContainer">
		</div>
		
	  <table style="width:200px">
	  
	  <tr><td colspan="2" style="border-top: 2px solid grey;"><a href="../fileupload/{{ id }}">Voeg een foto toe</a></td></tr>
	  <tr><th colspan="2">Landmarks</th></tr>
	  {%for mm in mmetings%}
	    <tr><td><div id="mm{{mm.id}}" style="width: 10px; height: 10px; background-color: red; display: inline; cursor: pointer;"> {{mm.name}}</div></td></tr>
	  {% endfor %}
	  <tr><th colspan="2">Geplaatste punten</th></tr>
	  {%for pt in punten %}
	    <tr><td>({{pt.x}},{{pt.y}})</td><td> in {{pt.mogelijkemeting.name}}</td></tr>
	  {% endfor %}
	  </table>
  </div>
  
  <div id="photosContextMenu" style="cursor:pointer;position:absolute; width:200px; right:20px; top:20px; border: 1px solid grey; z-index:9999">
	  <table style="width:200px">
	  <tr><th>Doorzichtbaarheid instellen</th></tr>
	  <tr><td colspan="2" id="sliders"></td></tr>
	  <tr><th>Reset foto's</th></tr>
	  <tr><td id="delete_images"></td></tr>
	  <tr><th>Coordinaten</th></tr>
	  <tr><td><input type="text" id="MouseX" value="0" size="4"> X<br />
	      <input type="text" id="MouseY" value="0" size="4"> Y</td></tr>
	  <tr><th>Ajax resultaten</th></tr>
	  <tr><td id="ajax_result"></td></tr>
	  </table>
	</div>
	
  <div id="big_images">
  </div>
  
  <div id="lmdd" style="display: none; position: absolute; background-color: white; color: black; padding: 5px;">
    <div style="background-color: #ccc;">Opslaan Meting</div>
    <label for="mmx">x: </label><input type="text" style="width: 25px;" id="lmmx" name="mmx" value="" />
    <label for="mmy">y: </label><input type="text" style="width: 25px;" id="lmmy" name="mmy" value="" /><br />
    <label for="mmmeting">Meting: </label><select id="mmmeting" name="mmmeting">
    <option value=""></option>
    {%for mm in mmetings%}
      <option value="{{mm.id}}">{{mm.name}}</option>
    {% endfor %}
    </select><br />
    <button onClick="saveLandMark();">Bewaar</button>
  </div>
  <div id="lmdisplay" style="display: none; position: absolute; background-color: red; width: 2px; height: 2px;">
  
  
  <script type="text/javascript" language="javascript">
  {%for mm in mmetings%}
    new Draggable('mm{{mm.id}}');
  {% endfor %}
  new Draggable('lmdd');
  </script>
{% endblock body %}
