
{% extends 'base.html' %}
{% block title %}Overzicht projecten en foto's{% endblock title %}

{% block head %}
  <link href="{{ BASE_PATH }}media/css/whiteFrame.css" rel="stylesheet" type="text/css" media="screen" />
  <link href="{{ BASE_PATH }}media/css/projectHome.css" rel="stylesheet" type="text/css" media="screen" />
	<script src="{{ BASE_PATH }}media/js/ajax.js" type="text/javascript"></script>
	<script src="{{ BASE_PATH }}media/js/getmouse.js" type="text/javascript"></script>
	<script src="{{ BASE_PATH }}media/js/images.js" type="text/javascript"></script>
	<script src="{{ BASE_PATH }}media/js/landmarks.js" type="text/javascript"></script>
  <script type="text/javascript">
  
    var total_images = 0;

	  document.observe("dom:loaded", function()
		{
      // Add tabs in whiteFrame
      $('whiteFrame_center_middle').insert(newTab('Pictures', $('pictureContainer')));
      $('whiteFrame_center_middle').insert(newTab('Possible measurements', $('tabContent_two')));
      $('whiteFrame_center_middle').insert(newTab('Done measurements', $('tabContent_tree')));
      $('whiteFrame_center_middle').insert(newTab('Transparency', $('photosContextMenu')));

		  // Add mouse listener for image
			document.observe('mousemove', getMouseXY);

			// Load images
			getProjectImages();

			// Make draggable's for each Measurement
			{% for mm in mmetings %}
				new Draggable('mm{{mm.id}}', { onEnd: function() {
						if($('MouseX').value != "" && $('MouseY').value != "") LoadMMDD('{{mm.id}}') 
					}
				});
			{% endfor %}
			new Draggable('lmdd');
			new Draggable('whiteFrame_container', { handle: 'whiteFrame_top_middle' });
			
		});

		function toggleTab(tab)
		{
			Effect.toggle(tab, 'blind', { duration: 0.5 });
		}
	  
		function newTab(tab_title, content)
		{
			var tabContainer = new Element('div');
			var tabHeader = new Element('div');
			var tabLine = new Element('div');
			if (Object.isElement(content)) {
				content.parentNode.removeChild(content);
			  tabBody = content;
			} else {
				var tabBody = new Element('div');
				tabBody.id = content;
			}	

  	  tabHeader.style.backgroundColor = "#dddddd";
  	  tabHeader.style.cursor = "pointer";
			tabHeader.observe('click', function(){
				  toggleTab(tabBody);
				}
			);
			tabHeader.innerHTML = "<img src=\"{{ BASE_PATH }}media/img/fold_down.gif\" style=\"float:left;margin:2px;\" />"+
                  				  "<img src=\"{{ BASE_PATH }}media/img/fold_down.gif\" style=\"float:right;margin:2px;\" /><b>"+tab_title+"</b>";

			tabLine.style.height = "2px";
			tabLine.style.backgroundImage = "url('{{ BASE_PATH }}media/img/bar_middle.jpg')";
			tabLine.style.backgroundRepeat = "repeat-x";
			tabLine.innerHTML = "<img src=\"{{ BASE_PATH }}media/img/bar_left.jpg\" style=\"float:left;\" />"+
			                    "<img src=\"{{ BASE_PATH }}media/img/bar_right.jpg\" style=\"float:right;\" />";
			
			// Return the three div's
			tabContainer.insert(tabHeader);
			tabContainer.insert(tabLine);
			tabContainer.insert(tabBody);
			return tabContainer;
		}
	  
		function getProjectImages()
		{
			var url = 'projectImagesJSON/{{id}}'
			// notice the use of a proxy to circumvent the Same Origin Policy
			new Ajax.Request(url, {
			  method: 'get',
			  onSuccess: function(transport, json) {
				  
			    var json = transport.responseText.evalJSON();
			    
			    //$('pictureContainerHeader').update('Pictures('+json.length+')');
			     
			    // Create a picture container for each picture
			    for(i=0; i < json.length; i++) {
						makePictureContainer(json[i]);
						alert('box toegevoegd');
			    }
				}
			});
		}

		function makePictureContainer(pictureJSON)
		{
			var mainDiv = new Element('div');
			     mainDiv.addClassName('projectPictureDiv');
			var leftDiv = new Element('div');
					 leftDiv.addClassName('pictureContainerLeftDiv');
			var rightDiv = new Element('div');
			    rightDiv.addClassName('pictureContainerRightDiv');
			
			leftDiv.insert(new Element('img',{'src': base_path+data_dir+'thumbnail/50/'+pictureJSON.fields.path}));
			rightDiv.insert(new Element('span').update(pictureJSON.fields.name).addClassName('projectPictureInfo'));
			rightDiv.insert(new Element('span').update(pictureJSON.fields.added).addClassName('projectPictureInfo'));
			
			if(pictureJSON.fields.isLeft)
			  rightDiv.insert(new Element('span').update('Left').addClassName('projectPictureInfo'));
			else
			 rightDiv.insert(new Element('span').update('Right').addClassName('projectPictureInfo'));
			
			var useLink = new Element('a',{'href':'#'}).update('Use');
			rightDiv.insert(useLink);
			$('pictureContainer').insert(mainDiv);
			useLink.observe('click', function(){                                          
				 	show_image(base_path+data_dir+pictureJSON.fields.path);
				 	return false;
				}
			);
			mainDiv.insert(leftDiv);
			mainDiv.insert(rightDiv);
		}


  </script>

{% endblock head %}

{% block body %}


<div id="whiteFrame_container" style="float:left;">

	<!-- Top white frame -->
	<div id="whiteFrame_top_container">
		<div id="whiteFrame_top_left"></div>
		<div id="whiteFrame_top_middle"></div>
		<div id="whiteFrame_top_right"></div>
	</div>

	<div id="whiteFrame_center_container">

		<!-- Left white frame -->
		<div id="whiteFrame_center_left"></div>

		<!-- Content white frame -->
		<div id="whiteFrame_center_middle">	  	
		</div>

		<!-- Right white frame -->
		<div id="whiteFrame_center_right"></div>

	</div>

	<!-- Bottom white frame -->
	<div id="whiteFrame_bottom_container">
		<div id="whiteFrame_bottom_left"></div>
		<div id="whiteFrame_bottom_center"></div>
		<div id="whiteFrame_bottom_right"></div>
	</div>
</div>


<div id="big_images" style="width:300px;height:300px;overflow:hidden;border:dashed 1px yellow;"></div>



<!-- NOT POSITIONED DIV's -->
  
<div style="overflow:hidden;" id="pictureContainer">

  <a href="../fileupload/{{ id }}">Voeg een foto toe</a>
  
</div>
	  	
      		
<div id="tabContent_two" >

	{%for mm in mmetings%}
		<div><img id="mm{{mm.id}}" 
							style="cursor: pointer; z-index: 5;" 
							src="{{BASE_PATH}}media/img/pin_red.gif" alt="pin" 
							onMouseOver="showLandmarkTooltip('{{mm.id}}');" 
						  onMouseOut="hideLandmarkTooltip('{{mm.id}}');" />{{mm.name}}</div>
	{% endfor %}

</div>

<div id="tabContent_tree" >

	{%for pt in punten %}
		<div>({{pt.x}},{{pt.y}}) in {{pt.mogelijkemeting.name}}</div>
	{% endfor %}
	
</div>
  
{%for mm in mmetings%}

  <div id="tooltip{{mm.id}}" style="position: absolute; z-index: 5;">{{mm.name}}</div>

{% endfor %}
  
<div id="photosContextMenu">
	<table style="width:200px">
		<tr><th>Doorzichtbaarheid instellen</th></tr>
		<tr><td colspan="2" id="sliders"></td></tr>
		<tr><th>Reset foto's</th></tr>
		<tr><td id="delete_images"></td></tr>
		<tr><th>Coordinaten</th></tr>
		<tr><td><input type="text" id="MouseX" value="0" size="4"> X<br />
		<input type="text" id="MouseY" value="0" size="4"> Y</td></tr>
		<tr><th>Ajax resultaten</th></tr>
		<tr><td id="ajax_result"></td></tr>
	</table>
</div>
	

  
<div id="lmdd" style="display: none; position: absolute; background-color: white; color: black; padding: 5px;">
	<div style="background-color: #ccc;">Opslaan Meting</div>
	<label for="mmx">x: </label><input type="text" style="width: 25px;" id="lmmx" name="mmx" value="" />
	<label for="mmy">y: </label><input type="text" style="width: 25px;" id="lmmy" name="mmy" value="" /><br />
	<label id="labelmmmeting" for="mmmeting">Meting: </label><select id="mmmeting" name="mmmeting">
	<option value=""></option>
		{%for mm in mmetings%}
			<option id="option{{mm.id}}" value="{{mm.id}}">{{mm.name}}</option>
		{% endfor %}
	</select><br />
	<button onClick="saveLandMark();">Bewaar</button>
</div>

{% endblock body %}
