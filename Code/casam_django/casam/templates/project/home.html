{% extends 'base.html' %}

{% block title %}Overzicht projecten en foto's{% endblock title %}

{% block head %}
  <link href="../media/css/projectHome.css" rel="stylesheet" type="text/css" media="screen" />
	<script src="../media/js/ajax.js" type="text/javascript"></script>
	<script src="../media/js/getmouse.js" type="text/javascript"></script>
	<script src="../media/js/images.js" type="text/javascript"></script>
	<script src="../media/js/landmarks.js" type="text/javascript"></script>
  <script type="text/javascript">
  var total_images = 0;
  </script>
  
  
  <script type="text/javascript">
	  document.observe("dom:loaded", function() {
			document.observe('mousemove',getMouseXY);
			$('pictureContainer').hide();
			getProjectImages();
			$('pictureContainerHeader').observe('click',function(){
					Effect.toggle('pictureContainer','blind');
				});
		});

		function getProjectImages()
		{			
			var url = 'projectImagesJSON/{{id}}'
				// notice the use of a proxy to circumvent the Same Origin Policy.
				new Ajax.Request(url, {
				  method: 'get',
				  onSuccess: function(transport,json) {
				     var json = transport.responseText.evalJSON();
				     $('pictureContainerHeader').update('Pictures('+json.length+')');
				     for(i=0;i < json.length;i++)
				     {
								makePictureContainer(json[i]);
				     }
				     Effect.BlindDown('pictureContainer');
					}
				});
		}

		function makePictureContainer(pictureJSON)
		{
		     var mainDiv = new Element('div');
		     var leftDiv = new Element('div');
		     leftDiv.addClassName('pictureContainerLeftDiv');
		     var rightDiv = new Element('div');
		     rightDiv.addClassName('pictureContainerRightDiv');
		     mainDiv.addClassName('projectPictureDiv');
		     leftDiv.insert(new Element('img',{'src': base_path+data_dir+'thumbnail/50/'+pictureJSON.fields.path}));
		     rightDiv.insert(new Element('span').update(pictureJSON.fields.name).addClassName('projectPictureInfo'));
		     rightDiv.insert(new Element('span').update(pictureJSON.fields.added).addClassName('projectPictureInfo'));
		     if(pictureJSON.fields.isLeft)
		     {
		    	 rightDiv.insert(new Element('span').update('Left').addClassName('projectPictureInfo'));
		     }else{
		    	 rightDiv.insert(new Element('span').update('Right').addClassName('projectPictureInfo'));
		     }
		     var useLink = new Element('a',{'href':'#'}).update('Use');
		     rightDiv.insert(useLink);
		     $('pictureContainer').insert(mainDiv);
		     useLink.observe('click',function(){                                          
		    	 show_image(base_path+data_dir+pictureJSON.fields.path);
		    	 return false;
			   });
			   mainDiv.insert(leftDiv);
			   mainDiv.insert(rightDiv);
		}
  </script>

{% endblock head %}

{% block body %}


<div style="float:left;width:300px;height:100px;position: absolute;color:white;background-color:black;">
	<img src="{{ BASE_PATH }}media/img/dock_user.jpg" style="float:left;width:48px;heigth:48px;font-size: 8pt;color:white;" />
	<div style="float:left;color:white;width:200px;height:55px;font-size: 8pt;margin-top:4px;margin-left:5px;">
		<b>Currently logged in:</b><br />
		{{ NAME }} (<a href="#">incorrect?</a>)<br />
		
		
		<div style="float:left;font-size: 8pt;color:white;">Automatic <a href="{{ BASE_PATH }}logout">logout</a> in 
		<script type="text/javascript">

var currentTime = new Date()
var minutes = currentTime.getMinutes()
if (minutes < 10){
minutes = "0" + minutes
}
document.write(minutes + " min")

		</script>
		</div>
	</div>
	<a href="{{BASE_PATH}}"><img border="0" src="{{ BASE_PATH }}media/img/dock_home.jpg" style="width:24px;heigth:24px;float:left;" /></a>
</div>


	<div style="float: left; border: 1px solid grey;">
		<div id="pictureContainerHeader">Pictures (loading)</div>
		<div id="pictureContainer">
		</div>
		
	  <table style="width:200px">
	  
	  <tr><td colspan="2" style="border-top: 2px solid grey;"><a href="../fileupload/{{ id }}">Voeg een foto toe</a></td></tr>
	  <tr><th colspan="2">Landmarks</th></tr>
	  {%for mm in mmetings%}
	    <tr><td><img id="mm{{mm.id}}" style="cursor: pointer; z-index: 5;" src="{{BASE_PATH}}media/img/pin_red.gif" alt="pin" onMouseOver="showLandmarkTooltip('{{mm.id}}');" onMouseOut="hideLandmarkTooltip('{{mm.id}}');" />{{mm.name}}</td></tr>
	  {% endfor %}
	  <tr><th colspan="2">Geplaatste punten</th></tr>
	  {%for pt in punten %}
	    <tr><td>({{pt.x}},{{pt.y}})</td><td> in {{pt.mogelijkemeting.name}}</td></tr>
	  {% endfor %}
	  </table>
  </div>
  
  {%for mm in mmetings%}
    <div id="tooltip{{mm.id}}" style="position: absolute; z-index: 5;">{{mm.name}}</div>
  {% endfor %}
  
  <div id="photosContextMenu" style="cursor:pointer;position:absolute; width:200px; right:20px; top:20px; border: 1px solid grey; z-index:9999">
	  <table style="width:200px">
	  <tr><th>Doorzichtbaarheid instellen</th></tr>
	  <tr><td colspan="2" id="sliders"></td></tr>
	  <tr><th>Reset foto's</th></tr>
	  <tr><td id="delete_images"></td></tr>
	  <tr><th>Coordinaten</th></tr>
	  <tr><td><input type="text" id="MouseX" value="0" size="4"> X<br />
	      <input type="text" id="MouseY" value="0" size="4"> Y</td></tr>
	  <tr><th>Ajax resultaten</th></tr>
	  <tr><td id="ajax_result"></td></tr>
	  </table>
	</div>
	
  <div id="big_images">
  </div>
  
  <div id="lmdd" style="display: none; position: absolute; background-color: white; color: black; padding: 5px;">
    <div style="background-color: #ccc;">Opslaan Meting</div>
    <label for="mmx">x: </label><input type="text" style="width: 25px;" id="lmmx" name="mmx" value="" />
    <label for="mmy">y: </label><input type="text" style="width: 25px;" id="lmmy" name="mmy" value="" /><br />
    <label id="labelmmmeting" for="mmmeting">Meting: </label><select id="mmmeting" name="mmmeting">
    <option value=""></option>
    {%for mm in mmetings%}
      <option id="option{{mm.id}}" value="{{mm.id}}">{{mm.name}}</option>
    {% endfor %}
    </select><br />
    <button onClick="saveLandMark();">Bewaar</button>
  </div>
  
  <div id="lmdisplay" style="display: none; position: absolute; background-color: red; width: 2px; height: 2px;">

  
  
  <script type="text/javascript" language="javascript">
  {%for mm in mmetings%}
    new Draggable('mm{{mm.id}}', { onEnd: function() { if($('MouseX').value != "" && $('MouseY').value != "") LoadMMDD('{{mm.id}}') }});
  {% endfor %}
  new Draggable('lmdd');
  </script>
{% endblock body %}
